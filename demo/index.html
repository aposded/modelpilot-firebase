<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ModelPilot Extension Demo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 800px;
        width: 100%;
        padding: 40px;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 32px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 16px;
      }

      .auth-section {
        text-align: center;
        padding: 40px 0;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 30px;
      }

      .user-info img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
      }

      .user-details {
        flex: 1;
        text-align: left;
      }

      .user-name {
        font-weight: 600;
        color: #333;
      }

      .user-email {
        font-size: 14px;
        color: #666;
      }

      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 10px;
      }

      button:hover:not(:disabled) {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .google-btn {
        background: white;
        color: #333;
        border: 2px solid #ddd;
      }

      .google-btn:hover {
        background: #f8f9fa;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .prompt-section {
        display: none;
      }

      .prompt-section.active {
        display: block;
      }

      .prompt-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid transparent;
      }

      .prompt-card:hover {
        border-color: #667eea;
        transform: translateX(5px);
      }

      .prompt-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
      }

      .prompt-desc {
        font-size: 14px;
        color: #666;
      }

      .input-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
      }

      input,
      textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
        transition: border-color 0.3s;
      }

      input:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      textarea {
        resize: vertical;
        min-height: 100px;
      }

      .response-section {
        margin-top: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        display: none;
      }

      .response-section.active {
        display: block;
      }

      .response-content {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 15px;
        white-space: pre-wrap;
        line-height: 1.6;
        color: #333;
      }

      .metadata {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
      }

      .metadata-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .metadata-label {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .metadata-value {
        font-size: 18px;
        font-weight: 600;
        color: #667eea;
      }

      .error {
        background: #fee;
        color: #c33;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        border-left: 4px solid #c33;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .loading.active {
        display: block;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üöÄ ModelPilot Extension Demo</h1>
      <p class="subtitle">
        Test your Firebase Extension with AI prompt processing
      </p>

      <!-- Auth Section -->
      <div id="authSection" class="auth-section">
        <button id="signInBtn" class="google-btn">
          <svg width="20" height="20" viewBox="0 0 24 24">
            <path
              fill="#4285F4"
              d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
            <path
              fill="#34A853"
              d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
            <path
              fill="#FBBC05"
              d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
            <path
              fill="#EA4335"
              d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
          </svg>
          Sign in with Google
        </button>
      </div>

      <!-- User Info (hidden initially) -->
      <div id="userInfo" class="user-info" style="display: none">
        <img id="userPhoto" src="" alt="User" />
        <div class="user-details">
          <div class="user-name" id="userName"></div>
          <div class="user-email" id="userEmail"></div>
        </div>
        <button id="signOutBtn" style="margin-left: auto">Sign Out</button>
      </div>

      <!-- Prompt Selection (hidden initially) -->
      <div id="promptSection" class="prompt-section">
        <h2 style="margin-bottom: 20px; color: #333">
          Choose a Prompt Template
        </h2>

        <div class="prompt-card" data-prompt="welcome-email">
          <div class="prompt-title">üìß Welcome Email</div>
          <div class="prompt-desc">
            Generate a friendly welcome email for new users
          </div>
        </div>

        <div class="prompt-card" data-prompt="product-description">
          <div class="prompt-title">üì¶ Product Description</div>
          <div class="prompt-desc">Create engaging product descriptions</div>
        </div>

        <div class="prompt-card" data-prompt="blog-intro">
          <div class="prompt-title">‚úçÔ∏è Blog Introduction</div>
          <div class="prompt-desc">
            Write captivating blog post introductions
          </div>
        </div>

        <!-- Custom Input Form -->
        <div id="inputForm" style="display: none; margin-top: 30px">
          <h3 style="margin-bottom: 20px; color: #333">Fill in the details</h3>
          <div id="dynamicInputs"></div>
          <button id="generateBtn" style="width: 100%">
            ‚ú® Generate Content
          </button>
        </div>
      </div>

      <!-- Loading -->
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Generating content with AI...</p>
      </div>

      <!-- Response Section -->
      <div id="responseSection" class="response-section">
        <h3 style="margin-bottom: 15px; color: #333">AI Response</h3>
        <div class="response-content" id="responseContent"></div>

        <h4 style="margin: 20px 0 15px; color: #333">Request Metadata</h4>
        <div class="metadata">
          <div class="metadata-item">
            <div class="metadata-label">Model</div>
            <div class="metadata-value" id="metadataModel">-</div>
          </div>
          <div class="metadata-item">
            <div class="metadata-label">Cost</div>
            <div class="metadata-value" id="metadataCost">-</div>
          </div>
          <div class="metadata-item">
            <div class="metadata-label">Tokens</div>
            <div class="metadata-value" id="metadataTokens">-</div>
          </div>
          <div class="metadata-item">
            <div class="metadata-label">Latency</div>
            <div class="metadata-value" id="metadataLatency">-</div>
          </div>
        </div>

        <button id="backBtn" style="margin-top: 20px; width: 100%">
          ‚Üê Generate Another
        </button>
      </div>

      <!-- Error Display -->
      <div id="errorDisplay" style="display: none" class="error"></div>
    </div>

    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
      import {
        getAuth,
        GoogleAuthProvider,
        signInWithPopup,
        onAuthStateChanged,
        signOut,
      } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
      import {
        getFunctions,
        httpsCallable,
      } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js';

      // ‚ö†Ô∏è IMPORTANT: Replace with your Firebase config
      const firebaseConfig = {
        apiKey: 'YOUR_API_KEY',
        authDomain: 'YOUR_PROJECT_ID.firebaseapp.com',
        projectId: 'YOUR_PROJECT_ID',
        storageBucket: 'YOUR_PROJECT_ID.appspot.com',
        messagingSenderId: 'YOUR_SENDER_ID',
        appId: 'YOUR_APP_ID',
      };

      // ‚ö†Ô∏è IMPORTANT: Replace with your actual function name
      const FUNCTION_NAME = 'ext-modelpilot-router-firebase-0fik-processprompt';

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const functions = getFunctions(app);
      const provider = new GoogleAuthProvider();

      // DOM elements
      const authSection = document.getElementById('authSection');
      const userInfo = document.getElementById('userInfo');
      const promptSection = document.getElementById('promptSection');
      const inputForm = document.getElementById('inputForm');
      const dynamicInputs = document.getElementById('dynamicInputs');
      const responseSection = document.getElementById('responseSection');
      const loading = document.getElementById('loading');
      const errorDisplay = document.getElementById('errorDisplay');

      let currentPrompt = null;

      // Prompt templates with input fields
      const promptTemplates = {
        'welcome-email': {
          inputs: [
            {
              name: 'userName',
              label: 'User Name',
              type: 'text',
              placeholder: 'John Doe',
            },
            {
              name: 'productName',
              label: 'Product Name',
              type: 'text',
              placeholder: 'Your App',
            },
          ],
        },
        'product-description': {
          inputs: [
            {
              name: 'productName',
              label: 'Product Name',
              type: 'text',
              placeholder: 'Amazing Widget',
            },
            {
              name: 'price',
              label: 'Price',
              type: 'text',
              placeholder: '99.99',
            },
            {
              name: 'features',
              label: 'Features (one per line)',
              type: 'textarea',
              placeholder: 'Durable\nAffordable\nEasy to use',
            },
          ],
        },
        'blog-intro': {
          inputs: [
            {
              name: 'topic',
              label: 'Blog Topic',
              type: 'text',
              placeholder: 'The Future of AI',
            },
            {
              name: 'audience',
              label: 'Target Audience',
              type: 'text',
              placeholder: 'Tech enthusiasts',
            },
            {
              name: 'tone',
              label: 'Tone',
              type: 'text',
              placeholder: 'Professional and engaging',
            },
          ],
        },
      };

      // Auth state listener
      onAuthStateChanged(auth, (user) => {
        if (user) {
          // User is signed in
          authSection.style.display = 'none';
          userInfo.style.display = 'flex';
          promptSection.classList.add('active');

          document.getElementById('userPhoto').src =
            user.photoURL || 'https://via.placeholder.com/50';
          document.getElementById('userName').textContent =
            user.displayName || 'User';
          document.getElementById('userEmail').textContent = user.email;
        } else {
          // User is signed out
          authSection.style.display = 'block';
          userInfo.style.display = 'none';
          promptSection.classList.remove('active');
          resetUI();
        }
      });

      // Sign in
      document
        .getElementById('signInBtn')
        .addEventListener('click', async () => {
          try {
            await signInWithPopup(auth, provider);
          } catch (error) {
            showError('Sign in failed: ' + error.message);
          }
        });

      // Sign out
      document
        .getElementById('signOutBtn')
        .addEventListener('click', async () => {
          try {
            await signOut(auth);
          } catch (error) {
            showError('Sign out failed: ' + error.message);
          }
        });

      // Prompt card selection
      document.querySelectorAll('.prompt-card').forEach((card) => {
        card.addEventListener('click', () => {
          const promptId = card.dataset.prompt;
          currentPrompt = promptId;
          showInputForm(promptId);
        });
      });

      // Show input form for selected prompt
      function showInputForm(promptId) {
        const template = promptTemplates[promptId];
        dynamicInputs.innerHTML = '';

        template.inputs.forEach((input) => {
          const group = document.createElement('div');
          group.className = 'input-group';

          const label = document.createElement('label');
          label.textContent = input.label;
          group.appendChild(label);

          if (input.type === 'textarea') {
            const textarea = document.createElement('textarea');
            textarea.name = input.name;
            textarea.placeholder = input.placeholder;
            group.appendChild(textarea);
          } else {
            const inputEl = document.createElement('input');
            inputEl.type = input.type;
            inputEl.name = input.name;
            inputEl.placeholder = input.placeholder;
            group.appendChild(inputEl);
          }

          dynamicInputs.appendChild(group);
        });

        inputForm.style.display = 'block';
        inputForm.scrollIntoView({ behavior: 'smooth' });
      }

      // Generate content
      document
        .getElementById('generateBtn')
        .addEventListener('click', async () => {
          if (!auth.currentUser) {
            showError('Please sign in first');
            return;
          }

          // Collect form data
          const context = {};
          const inputs = dynamicInputs.querySelectorAll('input, textarea');
          inputs.forEach((input) => {
            if (input.name === 'features' && input.value) {
              // Split features by newlines into array
              context[input.name] = input.value
                .split('\n')
                .filter((f) => f.trim());
            } else {
              context[input.name] = input.value;
            }
          });

          // Show loading
          loading.classList.add('active');
          inputForm.style.display = 'none';
          errorDisplay.style.display = 'none';

          try {
            // Call the extension function
            const processPrompt = httpsCallable(functions, FUNCTION_NAME);
            const result = await processPrompt({
              promptId: currentPrompt,
              context: context,
            });

            // Display response
            displayResponse(result.data);
          } catch (error) {
            console.error('Error calling function:', error);
            showError(error.message);
            inputForm.style.display = 'block';
          } finally {
            loading.classList.remove('active');
          }
        });

      // Display response
      function displayResponse(data) {
        document.getElementById('responseContent').textContent = data.response;
        document.getElementById('metadataModel').textContent =
          data.metadata.model;
        document.getElementById('metadataCost').textContent =
          '$' + data.metadata.modelPilot.cost.toFixed(4);
        document.getElementById('metadataTokens').textContent =
          data.metadata.usage.total_tokens;
        document.getElementById('metadataLatency').textContent =
          data.metadata.modelPilot.latency + 'ms';

        responseSection.classList.add('active');
        responseSection.scrollIntoView({ behavior: 'smooth' });
      }

      // Back to prompt selection
      document.getElementById('backBtn').addEventListener('click', () => {
        resetUI();
      });

      // Reset UI
      function resetUI() {
        inputForm.style.display = 'none';
        responseSection.classList.remove('active');
        errorDisplay.style.display = 'none';
        currentPrompt = null;
      }

      // Show error
      function showError(message) {
        errorDisplay.textContent = message;
        errorDisplay.style.display = 'block';
        errorDisplay.scrollIntoView({ behavior: 'smooth' });
      }
    </script>
  </body>
</html>
